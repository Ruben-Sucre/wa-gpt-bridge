â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸš€ INTEGRACIÃ“N LISTA - ÃšLTIMOS 2 PASOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… YA CONFIGURADO:
  â€¢ Bot corriendo con todos los cambios aplicados
  â€¢ Redis conectado y funcionando
  â€¢ WhatsApp credentials OK
  â€¢ Gemini API configurada
  â€¢ ngrok exponiendo webhook pÃºblicamente

ğŸ“ TU URL PÃšBLICA DE NGROK:
  https://agonisingly-unapprehended-vernice.ngrok-free.dev


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  PASO 1: IMPORTAR WORKFLOW EN n8n (2 minutos)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Abre en tu navegador:
   http://localhost:5678

2. Login:
   Usuario: admin
  Password: valor de N8N_BASIC_AUTH_PASSWORD en .env

3. En n8n:
   â€¢ Clic en "Workflows" (menÃº izquierdo)
   â€¢ Clic en el botÃ³n "+" o "Add Workflow"
   â€¢ Clic en el menÃº â‹® (arriba derecha)
   â€¢ Selecciona "Import from File"
   â€¢ Busca y selecciona:
     /home/ruben/auto_python/wa-gpt-bridge/n8n/flows/wa-gpt-openai.json
   â€¢ Clic en "Import"

4. Activar workflow:
   â€¢ Toggle en la esquina superior derecha (debe quedar en ACTIVO/verde)
   â€¢ Verifica que veas el nodo "Webhook" con URL


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  PASO 2: CONFIGURAR WEBHOOK EN META WHATSAPP (3 minutos)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Ve a: https://developers.facebook.com/apps

2. Selecciona tu app de WhatsApp Business

3. En el menÃº izquierdo:
   WhatsApp â†’ Configuration (o ConfiguraciÃ³n)

3. En la secciÃ³n "Webhooks", clic en "Configurar" o "Edit"

4. Configura:
   
   URL de devoluciÃ³n de llamada (Callback URL):
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ https://agonisingly-unapprehended-vernice.ngrok-free.dev/webhook/whatsapp â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   Token de verificaciÃ³n (Verify Token):
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Usa WEBHOOK_VERIFY_TOKEN (mismo valor configurado en n8n)    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. Clic en "Verificar y guardar" (Verify and save)
   
   âš ï¸ SI DA ERROR:
   â€¢ Verifica que copiaste bien la URL (con /webhook/whatsapp al final)
   â€¢ Verifica que ngrok estÃ¡ corriendo: ps aux | grep ngrok
   â€¢ Revisa logs de n8n: docker compose logs -f n8n

6. Una vez verificado (âœ… marca verde):
   â€¢ Busca "Subscribe to webhook fields"
   â€¢ Marca el checkbox "messages"
   â€¢ Clic en "Save" o "Guardar"


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ§ª PASO 3: PROBAR EL BOT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. En una terminal, ver logs en tiempo real:
   cd /home/ruben/auto_python/wa-gpt-bridge
   docker compose logs -f bot

2. Desde tu celular:
   â€¢ Abre WhatsApp
   â€¢ EnvÃ­a un mensaje al nÃºmero de tu WhatsApp Business
   â€¢ Mensaje de prueba: "Hola, necesito informaciÃ³n"

3. Observa los logs:
   â€¢ DeberÃ­as ver: "Processing message from +52XXXXXXXXXX. Provider: gemini"
   â€¢ Luego: "Generated response for +52XXXXXXXXXX"

4. En tu telÃ©fono:
   â€¢ En 15-30 segundos recibirÃ¡s la respuesta del bot âœ…

5. EnvÃ­a otro mensaje para probar que mantiene contexto:
   â€¢ "CuÃ©ntame mÃ¡s sobre eso"
   â€¢ El bot debe recordar la conversaciÃ³n anterior


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ“Š VERIFICACIONES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Health check:
  curl http://localhost:8000/health | python3 -m json.tool

Estado de servicios:
  docker compose ps

Ver logs del bot:
  docker compose logs -f bot

Ver logs de n8n:
  docker compose logs -f n8n

Verificar ngrok:
  curl http://127.0.0.1:4040/api/tunnels | python3 -m json.tool


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ› TROUBLESHOOTING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Webhook no verifica en Meta:
  â†’ Verifica ngrok: curl https://agonisingly-unapprehended-vernice.ngrok-free.dev/webhook/whatsapp
  â†’ Revisa logs n8n: docker compose logs n8n | tail -50

Bot no responde:
  â†’ Verifica health: curl http://localhost:8000/health
  â†’ Ver logs: docker compose logs bot | tail -50

Pierde contexto:
  â†’ Verifica Redis: docker compose exec redis redis-cli KEYS "conv:*"


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  â„¹ï¸ INFORMACIÃ“N ADICIONAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â€¢ Rate limiting: 10 mensajes por minuto por usuario
â€¢ LÃ­mite de contexto: 20 mensajes (Ãºltimos 10 pares)
â€¢ TTL de conversaciones: 24 horas
â€¢ LLM provider: Gemini 2.0 Flash

DocumentaciÃ³n completa:
  cat /home/ruben/auto_python/wa-gpt-bridge/DEPLOYMENT.md
  cat /home/ruben/auto_python/wa-gpt-bridge/TESTING.md


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Â¡Tu pipeline WhatsApp â†’ n8n â†’ Bot â†’ Gemini estÃ¡ listo! ğŸ‰

